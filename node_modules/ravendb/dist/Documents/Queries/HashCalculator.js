"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.HashCalculator = void 0;
const md5 = require("md5");
const TypeUtil_1 = require("../../Utility/TypeUtil");
class HashCalculator {
    constructor() {
        this._buffers = [];
    }
    getHash() {
        return md5(Buffer.concat(this._buffers));
    }
    write(o, mapper) {
        if (TypeUtil_1.TypeUtil.isNullOrUndefined(o)) {
            this._buffers.push(Buffer.from("null"));
            return;
        }
        if (typeof o === "number") {
            this._buffers.push(Buffer.from([o]));
        }
        else if (typeof o === "string") {
            this._buffers.push(Buffer.from(o));
        }
        else if (typeof o === "boolean") {
            this._buffers.push(Buffer.from(o ? [1] : [2]));
        }
        else if (Array.isArray(o)) {
            for (const item of o) {
                this.write(item, mapper);
            }
        }
        else if (typeof o === "object") {
            for (const key of Object.keys(o)) {
                this.write(key, mapper);
                this.write(o[key], mapper);
            }
        }
        else {
            this.write(mapper.toObjectLiteral(o), mapper);
        }
    }
}
exports.HashCalculator = HashCalculator;
